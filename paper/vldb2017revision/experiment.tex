\section{Evaluation}\label{sec:experiments}
In our experimental evaluation, we wanted to understand the effect of batching at the storage and the validator, the performance of our validator reordering algorithms and policies, and the impact of system configuration parameters. In particular, we asked the following questions:
\begin{enumerate}
\item\vspace{-.5em} How well do our validator reordering algorithms from Section~\ref{subsec:validator_reordering:algorithm} perform? How does batching and reordering at the validator using these algorithms affect the end-to-end system performance?
\item\vspace{-.5em} How does the batch size impact performance? 
%Using larger batches should give the validator and the storage more opportunities for reordering but it should also increase transaction latency, leading to more conflicts. 
\item\vspace{-.5em} How does storage and validator batching affect the system throughput, abort rate, and latency?
\item\vspace{-.5em} How do the different policies presented in Section~\ref{subsec:validator_reordering:policy} impact the system performance?
\item\vspace{-.5em} How does batching and reordering perform on micro-benchmarks and real workloads?
\end{enumerate}

\subsection{Experimental Setup}
\label{subsec:experiment:implementation}

%Our system architecture consists of four components: a transaction generator, a processor thread, a storage thread, and a validator thread. The threads communicate through queues of requests; that is, there is a generator queue, a processor queue, a storage queue, and a validator queue.

Our system architecture consists of four components: a transaction generator, a processor, storage, and a validator. The components communicate through request queues.
% of requests.
% that is, there is a generator queue, a processor queue, a storage queue, and a validator queue.
The transaction generator continuously produces new transactions into the system until the system reaches the maximum permitted concurrency level. The processor component multiplexes transactions, receives transaction requests from the transaction generator, sends read/write requests to the storage, sends validation requests to the validator, and replies to the transaction generator. It also restarts aborted transactions; thus, it only communicates commit decisions to the transaction generator. 
The storage thread continuously processes read and write requests. When batching is enabled, it buffers a batch of requests. When it processes a batch, it executes the optimal strategy that we discussed in Section~\ref{sec:overview}: It first executes all the write requests in the batch (discarding a write if a newer version exists in the storage), and then all the read requests. The validator performs backward validation. It caches the write sets of committed transactions for future validations until these writes are overwritten by later committed transactions. 
When batching is enabled, the validator collects the requests into a batch as they arrive, and runs one of the algorithms from Section~\ref{sec:validator_reordering} to determine a serialization order. Every transaction that passes validation is assigned an integer \emph{commit timestamp}, which corresponds to the version number of the updates it will install in the storage.
\eat{
When \emph{clustering} is enabled, the validator creates transaction batches by grouping together transactions based on their access patterns. It processes each batch when either there are enough transactions in the batch, or a timeout for that batch is reached.
}

Our system is implemented in Java. All the experiments run on a multicore machine, with Intel Core i7-5600U CPU @2.60GHz and 8GB RAM. We use a key-value model for the storage, which we implement as an in-memory hash table. As a default, we populate the database with 100K objects, each with an 8-byte key. The values are left null as they are not relevant to our evaluation. We generate a transactional workload where each transaction reads 5 objects and writes to 5 objects. The reads and writes are drawn from a Zipfian distribution, which is implemented based on the standard model by Gray et al.~\cite{gray1994quickly}. We limit the concurrency level to 600, i.e., at any time there are at most 600 live transactions in the system. The default batch size is 150 for both storage and validator.

% other configuration
The validator uses the sort-based greedy algorithm with the \texttt{prod-degree} policy and multi factor 2. The baseline configuration represents the system running with both storage and validator batching turned off.  All our experimental figures show the averages of 10 runs, each lasting for 60 seconds in between a 10-second warm-up and a 10-second cool-down time. The standard deviation was not significant in any of the experiments, so we omit the error bars for clarity of presentation.

% figures
\begin{figure*}[t]
    \centering
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/fvs/fvs}
        \vspace{-2em}
        \caption{Size of FVS per graph with different algorithms}
        \label{fig:fvs:fvs}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/fvs/latency}
        \vspace{-2em}
        \caption{Running time of finding FVS with different algorithms}
        \label{fig:fvs:latency}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/fvs/tps}
        \vspace{-2em}
        \caption{Throughput with SCC-based and sort-based greedy algorithms}
        \label{fig:fvs:tps}
    \end{minipage}
    \vspace{-1em}
\end{figure*}

\begin{figure*}[t]
    \centering
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/fvs/percent95_latency}
        \vspace{-2em}
        \caption{Percentile latency for greedy algorithms}
        \label{fig:fvs:p95}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
            \centering
            \includegraphics[width=\textwidth]{./exp_fig/bsize/tps}
            \vspace{-2em}
            \caption{Throughput with various batch sizes}
            \label{fig:bsize:tps}
        \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/bsize/abort}
        \vspace{-2em}
        \caption{Abort rate with various batch sizes}
        \label{fig:bsize:abort}
    \end{minipage}
    \vspace{-1em}
\end{figure*}

\begin{figure*}[t]
    \centering
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/bsize/percent95_latency}
        \vspace{-2em}
        \caption{Percentile latency with various batch sizes}
        \label{fig:bsize:p95}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
            \centering
            \includegraphics[width=\textwidth]{./exp_fig/basic/tps}
            \vspace{-2em}
            \caption{Throughput under workloads of Zipfian distribution}
            \label{fig:basic:tps}
        \end{minipage}    
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/basic/abort}
        \vspace{-2em}
        \caption{Abort rate under workloads of Zipfian distribution}
        \label{fig:basic:abort}
    \end{minipage}
    \vspace{-1em}
\end{figure*}

\begin{figure*}[t]
    \centering
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/basic/preabort}
        \vspace{-2em}
        \caption{Inter-batch aborts under workloads of Zipfian distribution}
        \label{fig:basic:preabort}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/basic/in_batch_abort}
        \vspace{-2em}
        \caption{Intra-batch aborts under workloads of Zipfian distribution}
        \label{fig:basic:in_batch_abort}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/basic/percent95_latency}
        \vspace{-2em}
        \caption{Percentile latency under workloads of Zipfian distribution}
        \label{fig:basic:p95}
    \end{minipage}
    \vspace{-1em}
\end{figure*}

\begin{figure*}[t]
    \centering
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/restart/tps}
        \vspace{-2em}
        \caption{Throughput with tail latency optimized policies}
        \label{fig:restart:tps}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/restart/abort}
        \vspace{-2em}
        \caption{Abort rate with tail latency optimized policies}
        \label{fig:restart:abort}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
            \centering
            \includegraphics[width=\textwidth]{./exp_fig/restart/percent100_latency}
            \vspace{-2em}
            \caption{Percentile latency with tail latency optimized policies}
            \label{fig:restart:p100}
        \end{minipage}
    \vspace{-1em}
\end{figure*}


% hard transactions
\begin{figure*}[t]
    \centering
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/weighted_size/tps}
        \vspace{-2em}
        \caption{Throughput with heterogenuous workloads}
        \label{fig:weighted:tps}
    \end{minipage}
\eat{
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/weighted_size/abort}
        \vspace{-2em}
        \caption{Abort rate with heterogenuous workloads}
        \label{fig:weighted:abort}
    \end{minipage}
}
    \begin{minipage}[b]{0.32\linewidth}
            \centering
            \includegraphics[width=\textwidth]{./exp_fig/weighted_size/percent95_latency}
            \vspace{-2em}
            \caption{Percentile latency with heterogenuous workloads}
            \label{fig:weighted:p95}
        \end{minipage}
        \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/weighted_size/tps_1}
        \vspace{-2em}
        \caption{Throughput of large size transactions}
        \label{fig:weighted:tps1}
    \end{minipage}
    \vspace{-1em}
\end{figure*}
\begin{figure*}[t]
    \centering
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/weighted_size/abort_1}
        \vspace{-2em}
        \caption{Abort rate of large size transactions}
        \label{fig:weighted:abort1}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{./exp_fig/weighted_size/percent95_latency_1}
        \vspace{-2em}
        \caption{Percentile latency of large size transactions}
        \label{fig:weighted:p951}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{{{./exp_fig/load/Z0.7.tps}}}
        \vspace{-2em}
        \caption{Throughput with micro benchmark}
        \label{fig:load:tps}
    \end{minipage}
    \vspace{-1em}
\end{figure*}

\begin{figure*}[t]
    \centering
    \begin{minipage}[b]{0.32\linewidth}
      	\centering
        \includegraphics[width=\textwidth]{{{./exp_fig/load/Z0.7.latency}}}
        \vspace{-2em}
        \caption{Average latency with micro benchmark}
        \label{fig:load:latency}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{{{./exp_fig/small_bank/Z0.9.tps}}}
        \vspace{-2em}
        \caption{Throughput with Small Bank benchmark}
        \label{fig:small_bank:tps}
    \end{minipage}
    \begin{minipage}[b]{0.32\linewidth}
        \centering
        \includegraphics[width=\textwidth]{{{./exp_fig/small_bank/Z0.9.latency}}}
        \vspace{-2em}
        \caption{Average latency with Small Bank benchmark}
        \label{fig:small_bank:latency}
    \end{minipage}
    \vspace{-1em}
\end{figure*}

\input{exp_greedy}
\input{exp_parallel_reorder}
\input{exp_batch_size}
\input{exp_basic}
\input{exp_policy}
\input{exp_benchmark} % include load and small bank experiments.
